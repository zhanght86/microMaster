(function(a,b){if(typeof define==="function"&&define.amd){define(["angular"],b)}else{if(a.hasOwnProperty("angular")){b(a.angular)}else{if(typeof exports==="object"){module.exports=b(require("angular"))}}}}(this,function(b){b=(b&&b.module)?b:window.angular;function a(h,g){var d;try{d=h[g]}catch(f){d=false}if(d){var e="__"+Math.round(Math.random()*10000000);try{h[g].setItem(e,e);h[g].removeItem(e,e)}catch(f){d=false}}return d}return b.module("ngStorage",[]).provider("$localStorage",c("localStorage")).provider("$sessionStorage",c("sessionStorage"));function c(d){var e=a(window,d);return function(){var f="ngStorage-";this.setKeyPrefix=function(i){if(typeof i!=="string"){throw new TypeError("[ngStorage] - "+d+"Provider.setKeyPrefix() expects a String.")}f=i};var g=b.toJson;var h=b.fromJson;this.setSerializer=function(i){if(typeof i!=="function"){throw new TypeError("[ngStorage] - "+d+"Provider.setSerializer expects a function.")}g=i};this.setDeserializer=function(i){if(typeof i!=="function"){throw new TypeError("[ngStorage] - "+d+"Provider.setDeserializer expects a function.")}h=i};this.supported=function(){return !!e};this.get=function(i){return e&&h(e.getItem(f+i))};this.set=function(i,j){return e&&e.setItem(f+i,g(j))};this.remove=function(i){e&&e.removeItem(f+i)};this.$get=["$rootScope","$window","$log","$timeout","$document",function(q,l,s,m,n){var o=f.length;var k=a(l,d),j=k||(s.warn("This browser does not support Web Storage!"),{setItem:b.noop,getItem:b.noop,removeItem:b.noop}),i={$default:function(u){for(var t in u){b.isDefined(i[t])||(i[t]=b.copy(u[t]))}i.$sync();return i},$reset:function(u){for(var t in i){"$"===t[0]||(delete i[t]&&j.removeItem(f+t))}return i.$default(u)},$sync:function(){for(var v=0,t=j.length,u;v<t;v++){(u=j.key(v))&&f===u.slice(0,o)&&(i[u.slice(o)]=h(j.getItem(u)))}},$apply:function(){var u;r=null;if(!b.equals(i,p)){u=b.copy(p);b.forEach(i,function(x,w){if(b.isDefined(x)&&"$"!==w[0]){j.setItem(f+w,g(x));delete u[w]}});for(var t in u){j.removeItem(f+t)}p=b.copy(i)}},$supported:function(){return !!k}},p,r;i.$sync();p=b.copy(i);q.$watch(function(){r||(r=m(i.$apply,100,false))});l.addEventListener&&l.addEventListener("storage",function(t){if(!t.key){return}var u=n[0];if((!u.hasFocus||!u.hasFocus())&&f===t.key.slice(0,o)){t.newValue?i[t.key.slice(o)]=h(t.newValue):delete i[t.key.slice(o)];p=b.copy(i);q.$apply()}});l.addEventListener&&l.addEventListener("beforeunload",function(){i.$apply()});return i}]}}}));