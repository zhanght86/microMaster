angular.module("tm.pagination",[]).directive("tmPagination",[function(){return{restrict:"EA",template:'<div class="page-list"><ul class="pagination" ng-show="conf.totalItems > 0"><li ng-class="{disabled: conf.currentPage == 1}" ng-click="prevPage()"><span>&laquo;</span></li><li ng-repeat="item in pageList track by $index" ng-class="{active: item == conf.currentPage, separate: item == \'...\'}" ng-click="changeCurrentPage(item)"><span>{{ item }}</span></li><li ng-class="{disabled: conf.currentPage == conf.numberOfPages}" ng-click="nextPage()"><span>&raquo;</span></li></ul><div class="page-total" ng-show="conf.totalItems > 0">每页&nbsp;&nbsp;<select ng-model="conf.itemsPerPage" ng-options="option for option in conf.perPageOptions " ng-change="changeItemsPerPage()"></select>&nbsp;&nbsp;条/共<strong>{{ conf.totalItems }}</strong>条 跳转至&nbsp;<input type="text" ng-model="jumpPageNum" ng-keyup="jumpPageKeyUp($event)"/><span>&nbsp;页</span></div><div class="no-items" ng-show="conf.totalItems <= 0">暂无数据</div></div>',replace:true,scope:{conf:"="},link:function(g,f,e){var d=g.conf;var c=9;var b=[10,15,20,30,50];var a=15;if(d.pagesLength){d.pagesLength=parseInt(d.pagesLength,10);if(!d.pagesLength){d.pagesLength=c}if(d.pagesLength%2===0){d.pagesLength+=1}}else{d.pagesLength=c}if(!d.perPageOptions){d.perPageOptions=c}function h(n,k){if(d.currentPage){d.currentPage=parseInt(g.conf.currentPage,10)}if(!d.currentPage){d.currentPage=1}if(d.totalItems){d.totalItems=parseInt(d.totalItems,10)}if(!d.totalItems){d.totalItems=0;return}if(d.itemsPerPage){d.itemsPerPage=parseInt(d.itemsPerPage,10)}if(!d.itemsPerPage){d.itemsPerPage=a}d.numberOfPages=Math.ceil(d.totalItems/d.itemsPerPage);if(g.conf.numberOfPages>0&&g.conf.currentPage>g.conf.numberOfPages){g.conf.currentPage=g.conf.numberOfPages}var j=g.conf.perPageOptions.length;var m;for(var l=0;l<j;l++){if(d.perPageOptions[l]==d.itemsPerPage){m=true}}if(!m){d.perPageOptions.push(d.itemsPerPage)}d.perPageOptions.sort(function(p,i){return p-i});g.pageList=[];if(d.numberOfPages<=d.pagesLength){for(l=1;l<=d.numberOfPages;l++){g.pageList.push(l)}}else{var o=(d.pagesLength-1)/2;if(d.currentPage<=o){for(l=1;l<=o+1;l++){g.pageList.push(l)}g.pageList.push("...");g.pageList.push(d.numberOfPages)}else{if(d.currentPage>d.numberOfPages-o){g.pageList.push(1);g.pageList.push("...");for(l=o+1;l>=1;l--){g.pageList.push(d.numberOfPages-l)}g.pageList.push(d.numberOfPages)}else{g.pageList.push(1);g.pageList.push("...");for(l=Math.ceil(o/2);l>=1;l--){g.pageList.push(d.currentPage-l)}g.pageList.push(d.currentPage);for(l=1;l<=o/2;l++){g.pageList.push(d.currentPage+l)}g.pageList.push("...");g.pageList.push(d.numberOfPages)}}}g.$parent.conf=d}g.prevPage=function(){if(d.currentPage>1){d.currentPage-=1}};g.nextPage=function(){if(d.currentPage<d.numberOfPages){d.currentPage+=1}};g.changeCurrentPage=function(i){if(i=="..."){return}else{d.currentPage=i;h();if(d.onChange){d.onChange()}}};g.changeItemsPerPage=function(){d.currentPage=1;h();if(d.onChange){d.onChange()}};g.jumpToPage=function(){num=g.jumpPageNum;if(num.match(/\d+/)){num=parseInt(num,10);if(num&&num!=d.currentPage){if(num>d.numberOfPages){num=d.numberOfPages}d.currentPage=num;h();if(d.onChange){d.onChange()}g.jumpPageNum=""}}};g.jumpPageKeyUp=function(j){var i=window.event?j.keyCode:j.which;if(i==13){g.jumpToPage()}};g.$watch("conf.totalItems",function(j,i){if(!j||j==i){if(d.onChange){d.onChange()}}h()})}}}]);